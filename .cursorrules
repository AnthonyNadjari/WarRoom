# WarRoom — Cursor / Claude project context

Personal strategic CRM for finance job applications. **Single-user only.** Not SaaS, not multi-tenant, not a prototype. Production-ready internal tool.

## Stack

- **Next.js 14** (App Router), TypeScript, Tailwind CSS
- **ShadCN-style UI**: Radix primitives in `components/ui/` (button, input, label, dialog, alert-dialog, select, tabs, dropdown-menu, separator, sheet)
- **Prisma** ORM with **Neon** PostgreSQL. Schema in `prisma/schema.prisma`, client singleton in `lib/prisma.ts`.
- **NextAuth v4**: Credentials provider (email + bcrypt password). Config in `lib/auth.ts`, session helpers in `lib/session.ts`.
- **Vercel**-ready

## Project structure

- **`/app`**: Routes. `(protected)/` = Dashboard, companies, contacts, interactions, settings (sidebar + mobile nav). `/login` public. `/api/auth/[...nextauth]` public.
- **`/app/actions`**: Server actions for CRUD (companies, contacts, interactions, search, settings).
- **`/components`**: `ui/` (ShadCN), `layout/` (sidebar, mobile-nav, header, theme-toggle, search-trigger), `search/` (search-context, search-dialog), forms (company-form, contact-form, interaction-form), delete-confirm-dialog, `providers.tsx` (SessionProvider).
- **`/lib`**: `auth.ts` (NextAuth options), `session.ts` (getSession, getCurrentUserId), `prisma.ts` (client singleton), `map-prisma.ts` (enum conversion), `utils.ts` (cn), `follow-up.ts` (follow-up severity).
- **`/types`**: `database.ts` — Company, Contact, Interaction, enums. `next-auth.d.ts` — session type augmentation.
- **`/hooks`**: `use-theme.tsx` (ThemeProvider, useTheme, localStorage), `use-debounce.ts`.
- **`/prisma`**: `schema.prisma` — User, Account, Session, VerificationToken (NextAuth) + Company, Contact, Interaction (business). `prisma.config.ts` at root for config.

## Conventions

1. **Auth**: Credentials only (email + password). Middleware (`middleware.ts`) uses `getToken()` from `next-auth/jwt` to redirect unauthenticated to `/login`. Server pages/actions use `getCurrentUserId()` from `lib/session.ts`.
2. **Protected layout**: `app/(protected)/layout.tsx` wraps ThemeProvider, SearchProvider, Sidebar, Header, MobileNav, SearchDialog. All child routes are protected.
3. **Data access**: All queries go through server actions in `app/actions/`. Every query filters by `userId` for data isolation. Prisma enums are converted with `lib/map-prisma.ts` when mapping to/from API types.
4. **Follow-up logic**: Use `getFollowUpSeverity(interaction)` from `lib/follow-up.ts`. Waiting 0–13 days → normal, 14–27 → orange, 28+ → red. `next_follow_up_date` ≤ today overrides to red.
5. **Delete**: Always use `DeleteConfirmDialog`; never silent delete. Cascade is in DB (contact → interactions, company → contacts → interactions).
6. **Forms**: Company/Contact use manual Save. Interaction form has debounced auto-save (500 ms) + visible Save button.
7. **Styling**: Tailwind + `cn()` from `lib/utils`. CSS variables in `app/globals.css` (--background, --foreground, etc.). Font: Inter.
8. **Theme**: Light default; dark toggle in header; key `warroom-theme` in localStorage.

## Key files

- **Schema**: `prisma/schema.prisma`
- **Auth config**: `lib/auth.ts`
- **Auth API route**: `app/api/auth/[...nextauth]/route.ts`
- **Middleware**: `middleware.ts` (JWT-based route protection)
- **Dashboard sections**: Red follow-ups, Orange follow-ups, Active interviews, Recently sent (by date_sent DESC)
- **Company detail**: Tabs "Interactions" and "People". People = hierarchical contacts by seniority; `manager_id` for indent.
- **Interactions**: Filters (status, company, priority, category, date range). Slide-over with `InteractionForm`. Follow-up badge from `getFollowUpSeverity`.
- **Search**: Cmd+K or search icon; company name, contact name, role title, email. `components/search/search-dialog.tsx`.
- **Settings**: Export interactions to CSV; sign out.

## When editing

- Add new UI primitives in `components/ui/` following existing ShadCN-style (Radix + cn + variants).
- New Prisma models: add to `prisma/schema.prisma`, include `userId` field with relation to User, add types in `types/database.ts`, run `npx prisma migrate dev`.
- Keep single-user: no tenant_id, no org, no invite flows.
- No placeholder UI; everything must be functional.
- Prefer server-loaded initial data; client state for filters and slide-overs; refetch after mutations where list must update.
